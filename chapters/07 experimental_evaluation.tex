\chapter{Experimental Evaluation}
\label{chapter:evaluation}


\section{Environment setup}
\input{tables/table-setup.tex}
We set up an experimental environment on a PC running Ubuntu 18.04 and Intel i7-9700 CPU @ 3.00GHz. We deploy the blockchain network in Docker host with Geth tools. Table~\ref{table:setup} summarizes Ethereum blockchain parameters in our experiment. The \(TSP\)'s server and \(Org\)'s server run within a Docker container for local testing. For example, a bank system we used for evaluation includes the following servers: LDAP server, web server. And each web server will interact with a remote Ethereum node through web3js. Although the TSP's system maintains an LDAP server, it is only for record user's information and doesn't responsible for registration. It only allows blockchain-based login without providing username and password. \par
In our proposed ecosystem, we use consortium blockchain as our blockchain network. The consortium blockchain is a "semi-private" system and works across different organizations. This blockchain is only used internally for a certain organization or TSP. It needs to pre-allocate several nodes as sealers that are responsible for mining blocks. Other nodes can send transactions, call smart contract, but they don't have right to mine blocks. In tern of consensus algorithm, Proof of Work (PoW) consensus algorithm is the most reliable and secure, it can provide a trustless economic system. Although it secure and trustless, PoW has the worst performance and has lower tps. In our experiment, we adopt Proof of Authority (PoA) that relies on a limited number of sealers, and it is regarded as an effective and reasonable solution for our scenario.
\section{Gas consumption}
\input{tables/table-gas-consumption}
The Ethereum gas refers to the computational expense on the Ethereum network. The amount of gas consumption is determined by the difficulty of calculation. Table~\ref{table:gasUsed} shows the gas consumption of each smart contract function and contract deployment fee. There is a significant difference between the two type function calls. In the case of the deployment contract, it will spend more gas such \textit{bindAccount}. In other words, if the function does not involve complex logic or deployment, it will consume less gas such as \textit{addUser}, \textit{authorize}, \textit{revoke}.

\section{Performance evaluation}
To analyze and measure the performance of various system services, particularly our web applications. We used the Apache JMeter tools to perform stress testing on system functions and modules. Meanwhile, in order to be closer to the reality of the situation, we also simulated the functions of the general system for comparison. We have divided the evaluation results into three parts: User Login System, Account Integration, and Data Sharing. The number of users for our throughput performance testing is 1,000, 2,000, 3,000, and 5,000. The send rate (transaction per second) varies from 10 to 800, depending on the intention of each function.
\input{tables/table-metrics.tex}

\subsection*{User Login System}
\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=0.9\linewidth,keepaspectratio=true]{figures/login-throughput.png}
    \caption{{\footnotesize Throughput of various login systems under different users.}}
    \label{fig:loginThroughput}
\end{figure}
The results of the performance analysis are shown in Figure~\ref{fig:loginThroughput}. The \textit{Login} means that the user sent a login request included username and password to the server for authentication. We also tested blockchain-base login with two different consensus algorithms (\textit{Login(POA)}, \textit{Login(POW)}). As far as \textit{Login} function is concerned, there is not much difference between these two consensus algorithms, because the login process is a read-operation. Although login with blockchain has lower performance than general login, it can still meet the login needs.
\newpage

\subsection*{Account Integration}
\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=1\linewidth,keepaspectratio=true]{figures/smart_contract_tps.png}
    \caption{{\footnotesize Throughput of smart contract functions under different users.}}
    \label{fig:contract_tps}
\end{figure}
As shown in Figure~\ref{fig:contract_tps}, the throughput for different functions of the smart contract. These functions above are write-operations that will update the state of the blockchain. A transaction is broadcasted to the entire blockchain network, processed transactions by miners, and then is published to the blockchain. The throughput will vary according to the complexity of the state change. As shown in the line chart above, the simpler the function, the higher the throughput, which also means that more transactions can be accommodated in the same block. However, the observed difference between \textit{Bind} and others in this result was significant, only five transactions per second. This is reasonable due to the creation of \textit{ACMgr}. Although the throughput is low, each user only needs to do once, so that the performance complies with integration requirements.

\newpage

\subsection*{Data Sharing}



\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=1\linewidth,keepaspectratio=true]{figures/authorize_comparsion.png}
    \caption{{\footnotesize Throughput of mode 1 and mode 2 under different users.}}
    \label{fig:authorize_compare}
\end{figure}

\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=1\linewidth,keepaspectratio=true]{figures/query.png}
    \caption{{\footnotesize Throughput of normal query and blockchain-based query under different users.}}
    \label{fig:query}
\end{figure}