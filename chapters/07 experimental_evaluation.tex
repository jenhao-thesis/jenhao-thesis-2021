\chapter{Experimental Evaluation}
\label{chapter:evaluation}


\section{Environment setup}
\input{tables/table-setup.tex}
We set up an experimental environment on a PC running Ubuntu 18.04 and Intel i7-9700 CPU @ 3.00GHz. We deploy the blockchain network in Docker host with Geth tools. Table~\ref{table:setup} summarizes Ethereum blockchain parameters in our experiment. The \(TSP\)'s server and \(Org\)'s server run within a Docker container for local testing. For example, a bank system we used for evaluation includes the following servers: LDAP server, web server. And each web server will interact with a remote Ethereum node through web3js. Although the TSP's system maintains an LDAP server, it is only for record user's information and doesn't responsible for registration. It only allows blockchain-based login without providing username and password. \par
In our proposed ecosystem, we use consortium blockchain as our blockchain network. The consortium blockchain is a "semi-private" system and works across different organizations. This blockchain is only used internally for a certain organization or TSP. It needs to pre-allocate several nodes as sealers that are responsible for mining blocks. Other nodes can send transactions, call smart contract, but they don't have right to mine blocks. In tern of consensus algorithm, Proof of Work (PoW) consensus algorithm is the most reliable and secure, it can provide a trustless economic system. Although it secure and trustless, PoW has the worst performance and has lower tps. In our experiment, we adopt Proof of Authority (PoA) that relies on a limited number of sealers, and it is regarded as an effective and reasonable solution for our scenario.
\section{Gas consumption}
\input{tables/table-gas-consumption}
The Ethereum gas refers to the computational expense on the Ethereum network. The amount of gas consumption is determined by the difficulty of calculation. Table~\ref{table:gasUsed} shows the gas consumption of each smart contract function and contract deployment fee. There is a significant difference between the two type function calls. In the case of the deployment contract, it will spend more gas such \textit{bindAccount}. In other words, if the function does not involve complex logic or deployment, it will consume less gas such as \textit{addUser}, \textit{authorize}, \textit{revoke}.

\section{Performance evaluation}
To analyze and measure the performance of various system services, particularly our web applications. We used the Apache JMeter tools to perform stress testing on system functions and modules. Meanwhile, in order to be closer to the reality of the situation, we also simulated the functions of the general system for comparison. We have divided the evaluation results into three parts: User Login System, Account Integration, and Data Sharing. The number of users for our throughput performance testing is 1000, 2000, 3000, and 5000. The send rate (transaction per second) varies from 10 to 800, depending on the intention of each function.
\subsection*{User Login System}
\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=0.9\linewidth,keepaspectratio=true]{figures/login-throughput.png}
    \caption{{\footnotesize Throughput of various login systems under different users.}}
    \label{fig:loginThroughput}
\end{figure}

\newpage

\subsection*{Account Integration}
\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=1\linewidth,keepaspectratio=true]{figures/smart_contract_tps.png}
    \caption{{\footnotesize Throughput of smart contract functions under different users.}}
    \label{fig:contract_tps}
\end{figure}
\newpage

\subsection*{Data Sharing}



\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=1\linewidth,keepaspectratio=true]{figures/authorize_comparsion.png}
    \caption{{\footnotesize Throughput of mode 1 and mode 2 under different users.}}
    \label{fig:authorize_compare}
\end{figure}

\begin{figure}[htb]
    \centering
    \includegraphics[height=!,width=1\linewidth,keepaspectratio=true]{figures/query.png}
    \caption{{\footnotesize Throughput of normal query and blockchain-based query under different users.}}
    \label{fig:query}
\end{figure}